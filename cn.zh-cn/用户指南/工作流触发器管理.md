# 工作流触发器管理<a name="functiongraph_01_0330"></a>

工作流触发器可以被编排在Event类型的工作流中，称为内部触发器。也可以与工作流绑定，称为外部触发器。

内部触发器编排在工作流中，只有执行工作流，使工作流处于运行状态后，当对应的事件产生时，才能触发工作流内部节点运行。内部触发器的使用可以参考[执行工作流](工作流管理.md#section106943215479)。

可以在工作流创建以后再绑定外部触发器，对应事件产生时，可以触发工作流执行。外部触发器的使用可以参考[工作流绑定外部触发器](工作流绑定外部触发器.md)。

## 前提条件<a name="section28989356145359"></a>

已开启消息通知服务，并且在消息通知服务中创建主题。创建过程请参考[创建消息主题](https://support.huaweicloud.com/usermanual-smn/zh-cn_topic_0043961401.html)。

## 创建工作流触发器<a name="section1184012349393"></a>

工作流触发器用于编排在工作流中，触发某个事件的执行。目前支持的工作流触发器类型有SMN、Worker、OBS。

1.  用户登录FunctionGraph，选择“工作流\>工作流触发器”，进入“工作流触发器”界面。
2.  在“工作流触发器”界面，单击“创建触发器”，进入“创建触发器”界面。
3.  在“创建触发器”界面，填写触发器配置信息。如[表1](#table16705107144049)、[表2](#table19132495155948)所示。带\*参数为必填项。

    **表 1**  触发器配置信息

    <a name="table16705107144049"></a>
    <table><thead align="left"><tr id="row14493034144049"><th class="cellrowborder" valign="top" width="50%" id="mcps1.2.3.1.1"><p id="p29330435144049"><a name="p29330435144049"></a><a name="p29330435144049"></a>配置项</p>
    </th>
    <th class="cellrowborder" valign="top" width="50%" id="mcps1.2.3.1.2"><p id="p26955041144049"><a name="p26955041144049"></a><a name="p26955041144049"></a>说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row41268785144049"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.1 "><p id="p54437320144049"><a name="p54437320144049"></a><a name="p54437320144049"></a>*名称</p>
    </td>
    <td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.2 "><p id="p47346762144049"><a name="p47346762144049"></a><a name="p47346762144049"></a>触发器名称，命名规则为：触发器的名称只能包含大写字母、小写字母、数字和特殊字符(-)，长度小于等于32个字符。</p>
    </td>
    </tr>
    <tr id="row23467680144049"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.1 "><p id="p21833904144049"><a name="p21833904144049"></a><a name="p21833904144049"></a>描述</p>
    </td>
    <td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.2 "><p id="p23715809144049"><a name="p23715809144049"></a><a name="p23715809144049"></a>触发器的描述长度小于等于256个字符。</p>
    </td>
    </tr>
    <tr id="row12115693144049"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.1 "><p id="p41847090144049"><a name="p41847090144049"></a><a name="p41847090144049"></a>*事件源</p>
    </td>
    <td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.2 "><p id="p34171115144049"><a name="p34171115144049"></a><a name="p34171115144049"></a>支持SMN、OBS和Worker。</p>
    </td>
    </tr>
    </tbody>
    </table>

    **表 2**  事件源配置项说明

    <a name="table19132495155948"></a>
    <table><thead align="left"><tr id="row16539702155948"><th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.1"><p id="p44956604155948"><a name="p44956604155948"></a><a name="p44956604155948"></a>事件源</p>
    </th>
    <th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.2"><p id="p17606317155948"><a name="p17606317155948"></a><a name="p17606317155948"></a>配置项</p>
    </th>
    <th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.3"><p id="p16825574155948"><a name="p16825574155948"></a><a name="p16825574155948"></a>说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row50582656155948"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p3554432155948"><a name="p3554432155948"></a><a name="p3554432155948"></a>SMN</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p245540316654"><a name="p245540316654"></a><a name="p245540316654"></a>*主题</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p6466992916654"><a name="p6466992916654"></a><a name="p6466992916654"></a>SMN消息主题，从已创建消息主题中选择，如果未创建，需要去“消息通知服务”创建，请参考<a href="https://support.huaweicloud.com/usermanual-smn/zh-cn_topic_0043961401.html" target="_blank" rel="noopener noreferrer">创建消息主题</a>。</p>
    </td>
    </tr>
    <tr id="row11106912387"><td class="cellrowborder" rowspan="4" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p10362234173812"><a name="p10362234173812"></a><a name="p10362234173812"></a>OBS</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p54660729143339"><a name="p54660729143339"></a><a name="p54660729143339"></a>*存储桶</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p3641961992349"><a name="p3641961992349"></a><a name="p3641961992349"></a>用作事件源的OBS存储桶。如果未创建，需要去“对象存储服务”创建，请参考<a href="https://support.huaweicloud.com/usermanual-obs/zh-cn_topic_0045829050.html" target="_blank" rel="noopener noreferrer">创建存储桶</a>。</p>
    </td>
    </tr>
    <tr id="row4985161315382"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p151931753123117"><a name="p151931753123117"></a><a name="p151931753123117"></a>*事件类型</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p32389141113256"><a name="p32389141113256"></a><a name="p32389141113256"></a>选择要使其触发工作流的事件。支持的事件类型请参考<a href="#functiongraph_01_0330__table352315412288">表3</a>。</p>
    </td>
    </tr>
    <tr id="row7431121663812"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p392857183111"><a name="p392857183111"></a><a name="p392857183111"></a>前缀</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p5921957193115"><a name="p5921957193115"></a><a name="p5921957193115"></a>用来限制以此关键字开头的对象的事件通知，该限制可以实现对OBS对象名的过滤。</p>
    </td>
    </tr>
    <tr id="row11923122015388"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p31983043216"><a name="p31983043216"></a><a name="p31983043216"></a>后缀</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p1206200123216"><a name="p1206200123216"></a><a name="p1206200123216"></a>用来限制以此关键字结尾的对象的事件通知。该限制可以实现对OBS对象名的过滤。</p>
    </td>
    </tr>
    <tr id="row36246781155948"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p50308168155948"><a name="p50308168155948"></a><a name="p50308168155948"></a>Worker</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p48429820155948"><a name="p48429820155948"></a><a name="p48429820155948"></a>*事件类型</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p30501311155948"><a name="p30501311155948"></a><a name="p30501311155948"></a>从下拉列表中选择，支持</p>
    <p id="p925505516850"><a name="p925505516850"></a><a name="p925505516850"></a>WorkRequest、HeartBeat、WorkSuccess、WorkFailure四种类型。</p>
    </td>
    </tr>
    </tbody>
    </table>

    **表 3**  OBS事件说明

    <a name="table352315412288"></a>
    <table><thead align="left"><tr id="row1252324192813"><th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.1"><p id="p28875330114531"><a name="p28875330114531"></a><a name="p28875330114531"></a>事件类</p>
    </th>
    <th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.2"><p id="p57200411114531"><a name="p57200411114531"></a><a name="p57200411114531"></a>事件</p>
    </th>
    <th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.3"><p id="p2721684114531"><a name="p2721684114531"></a><a name="p2721684114531"></a>事件说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row185231241162814"><td class="cellrowborder" rowspan="5" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p37950592114531"><a name="p37950592114531"></a><a name="p37950592114531"></a>ObjectCreated</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p54099137114531"><a name="p54099137114531"></a><a name="p54099137114531"></a>—</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p36111109135927"><a name="p36111109135927"></a><a name="p36111109135927"></a>新对象创建事件，选择ObjectCreated时，意味着Put/Post/Copy/CompleteMultipartUpload都被选上。</p>
    </td>
    </tr>
    <tr id="row1523154172819"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p34343507114531"><a name="p34343507114531"></a><a name="p34343507114531"></a>Put</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p30360720114531"><a name="p30360720114531"></a><a name="p30360720114531"></a>更新对象。</p>
    </td>
    </tr>
    <tr id="row13523144118289"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p23983720114531"><a name="p23983720114531"></a><a name="p23983720114531"></a>Post</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p63633133114531"><a name="p63633133114531"></a><a name="p63633133114531"></a>上传对象。</p>
    </td>
    </tr>
    <tr id="row115237412280"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p47588189114531"><a name="p47588189114531"></a><a name="p47588189114531"></a>Copy</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p29438085114531"><a name="p29438085114531"></a><a name="p29438085114531"></a>复制对象。</p>
    </td>
    </tr>
    <tr id="row252364142818"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p63269305114649"><a name="p63269305114649"></a><a name="p63269305114649"></a>CompleteMultipartUpload</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p42098801405"><a name="p42098801405"></a><a name="p42098801405"></a>使用多段上传方式上传对象，多个段成功合并时触发。</p>
    </td>
    </tr>
    <tr id="row7523184152816"><td class="cellrowborder" rowspan="3" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p38633980114531"><a name="p38633980114531"></a><a name="p38633980114531"></a>ObjectRemoved</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p42344655114531"><a name="p42344655114531"></a><a name="p42344655114531"></a>—</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p6335903214027"><a name="p6335903214027"></a><a name="p6335903214027"></a>对象删除事件，选择ObjectRemoved，意味着Delete/DeleteMarkerCreated都被选上。</p>
    </td>
    </tr>
    <tr id="row115317412282"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p30596785114531"><a name="p30596785114531"></a><a name="p30596785114531"></a>Delete</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p62420541114531"><a name="p62420541114531"></a><a name="p62420541114531"></a>对象删除。</p>
    </td>
    </tr>
    <tr id="row4500174622817"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p35668554114827"><a name="p35668554114827"></a><a name="p35668554114827"></a>DeleteMarkerCreated</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p3167791414110"><a name="p3167791414110"></a><a name="p3167791414110"></a>在OBS服务开启多版本支持后，如果不指定版本号删除对象，OBS会自动为该对象生成删除标记，此时会触发本事件。</p>
    </td>
    </tr>
    </tbody>
    </table>


1.  单击“确定”，完成触发器创建。

## 绑定工作流触发器<a name="section5109194764014"></a>

对于Event类型的工作流，由于已经编排内部工作流触发器，不能再绑定外部触发器。HelloWorld、Operation、Switch、Delay等类型的工作流均可绑定外部工作流触发器。

1.  用户登录FunctionGraph，选择“工作流\>工作流列表”，进入“工作流列表”界面。
2.  在“工作流列表”界面，单击工作流名称，进入工作流详情界面。
3.  在工作流详情界面，单击“触发器”页签，进入触发界面。
4.  单击“绑定触发器”，如[图1](#fig33748573102635)所示，弹出“绑定触发器”界面。

    **图 1**  绑定触发器<a name="fig33748573102635"></a>  
    ![](figures/绑定触发器.png "绑定触发器")

5.  在“绑定触发器”界面，输入如下信息，如[表4](#table4297779011238)所示。

    **表 4**  绑定触发器

    <a name="table4297779011238"></a>
    <table><thead align="left"><tr id="row923287511238"><th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.1"><p id="p1987963511238"><a name="p1987963511238"></a><a name="p1987963511238"></a>参数</p>
    </th>
    <th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.2"><p id="p6674663511238"><a name="p6674663511238"></a><a name="p6674663511238"></a>类型</p>
    </th>
    <th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.3"><p id="p3776833911238"><a name="p3776833911238"></a><a name="p3776833911238"></a>操作说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row437073211238"><td class="cellrowborder" rowspan="2" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p1848504011238"><a name="p1848504011238"></a><a name="p1848504011238"></a>触发器类型</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p2089327211238"><a name="p2089327211238"></a><a name="p2089327211238"></a>已创建</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p1463348511238"><a name="p1463348511238"></a><a name="p1463348511238"></a>-</p>
    </td>
    </tr>
    <tr id="row6459250311238"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p6605033311238"><a name="p6605033311238"></a><a name="p6605033311238"></a>新创建</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p4847672811238"><a name="p4847672811238"></a><a name="p4847672811238"></a>新创建工作流触发器，请参考<a href="#functiongraph_01_0330__section1184012349393">创建工作流触发器</a>。</p>
    </td>
    </tr>
    <tr id="row3363737211238"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p4027264811238"><a name="p4027264811238"></a><a name="p4027264811238"></a>触发器</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p4085902311238"><a name="p4085902311238"></a><a name="p4085902311238"></a>-</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p2124658711238"><a name="p2124658711238"></a><a name="p2124658711238"></a>从已创建的工作流触发器列表中选择。</p>
    </td>
    </tr>
    </tbody>
    </table>

6.  单击“确定”，完成触发器绑定。

## 解绑工作流触发器<a name="section26731058174112"></a>

1.  用户登录FunctionGraph，选择“工作流\>工作流列表”，进入“工作流列表”界面。
2.  在“工作流列表”界面，单击工作流名称，进入工作流详情界面。
3.  在工作流详情界面，单击“触发器”页签，进入“触发器”界面。
4.  在“触发器”界面，选中触发器，单击“解除绑定”，如[图2](#fig61084372172224)所示，弹出“解绑触发器”界面。

    **图 2**  解绑触发器<a name="fig61084372172224"></a>  
    ![](figures/解绑触发器.png "解绑触发器")

5.  在“解绑触发器”界面，单击“确定”，完成触发器解绑。

## 删除工作流触发器<a name="section142615327429"></a>

1.  用户登录FunctionGraph，选择“工作流\>工作流触发器”，进入“工作流触发器”界面。
2.  在“工作流触发器”界面，选择待删除的触发器，单击“删除”，如[图3](#fig13520261172659)所示，弹出“删除触发器”界面。

    **图 3**  删除工作流触发器<a name="fig13520261172659"></a>  
    ![](figures/删除工作流触发器.png "删除工作流触发器")

3.  在“删除触发器”界面，输入“DELETE”（大写），单击“确定”，完成工作流触发器删除。如[图4](#fig185827485101)所示。

    **图 4**  删除校验<a name="fig185827485101"></a>  
    ![](figures/删除校验.png "删除校验")

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >触发器可能被其他工作流调用，删除后会造成工作流不可用，删除后无法恢复，请谨慎操作。  


