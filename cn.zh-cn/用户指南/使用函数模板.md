# 使用函数模板<a name="functiongraph_01_0401"></a>

FunctionGraph平台提供了函数模板，在创建函数时选择模板，实现模板代码、触发器、运行环境自动填充，快速构建应用程序。

## 函数模板说明<a name="section11668111811482"></a>

FunctionGraph提供了24个模板，包括18个入门级模板和6个进阶级模板，说明如[表1](#table4658883110497)所示。

**表 1**  模板说明

<a name="table4658883110497"></a>
<table><thead align="left"><tr id="row3226503410497"><th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.1"><p id="p3310752410497"><a name="p3310752410497"></a><a name="p3310752410497"></a>模板类别</p>
</th>
<th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.2"><p id="p6446375710497"><a name="p6446375710497"></a><a name="p6446375710497"></a>模板名称</p>
</th>
<th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.3"><p id="p5418179010497"><a name="p5418179010497"></a><a name="p5418179010497"></a>模板说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row1787406510497"><td class="cellrowborder" rowspan="10" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p3851318610497"><a name="p3851318610497"></a><a name="p3851318610497"></a>入门级</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p12927153193810"><a name="p12927153193810"></a><a name="p12927153193810"></a>context使用指导</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p2014675410497"><a name="p2014675410497"></a><a name="p2014675410497"></a>使用函数获取访问其他华为云服务所需的临时凭证，包括AK、SK、Token等。</p>
</td>
</tr>
<tr id="row4710306510497"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p689106510497"><a name="p689106510497"></a><a name="p689106510497"></a>从OBS下载文件</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p2130538210497"><a name="p2130538210497"></a><a name="p2130538210497"></a>使用函数从指定的OBS（对象存储服务）桶中下载文件，读取文件并返回文件大小。</p>
</td>
</tr>
<tr id="row5753071210497"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p164581334153911"><a name="p164581334153911"></a><a name="p164581334153911"></a>上传文件到OBS</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p5198316710497"><a name="p5198316710497"></a><a name="p5198316710497"></a>使用函数上传本地文件至指定的OBS（对象存储服务）桶。</p>
</td>
</tr>
<tr id="row6519532610497"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p146012364012"><a name="p146012364012"></a><a name="p146012364012"></a>DMS触发器使用指导</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p022511664016"><a name="p022511664016"></a><a name="p022511664016"></a>函数定期从DMS（分布式消息服务）消费组拉取待消费消息，打印消息内容及属性。</p>
</td>
</tr>
<tr id="row5242489910497"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p2683763210497"><a name="p2683763210497"></a><a name="p2683763210497"></a>SMN触发器使用指导</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p103281788466"><a name="p103281788466"></a><a name="p103281788466"></a>使用SMN（消息通知服务）消息触发函数，打印消息的内容和标题。</p>
</td>
</tr>
<tr id="row3595453310497"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p1003560310497"><a name="p1003560310497"></a><a name="p1003560310497"></a>DIS触发器使用指导</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p757751910497"><a name="p757751910497"></a><a name="p757751910497"></a>函数定期从DIS（数据接入服务）数据通道拉取数据，打印数据信息。</p>
</td>
</tr>
<tr id="row108881110497"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p1110771920483"><a name="p1110771920483"></a><a name="p1110771920483"></a>APIG触发器使用指导</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p2623210310497"><a name="p2623210310497"></a><a name="p2623210310497"></a>使用API网关调用函数服务，在函数中演示了返回不同的内容，如HTML页面和json结构体。</p>
</td>
</tr>
<tr id="row763614162428"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p1885314311425"><a name="p1885314311425"></a><a name="p1885314311425"></a>LTS触发器使用指导</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p46384169422"><a name="p46384169422"></a><a name="p46384169422"></a>使用LTS（云日志服务）日志触发函数执行，打印日志组ID、日志主题ID和日志的内容。</p>
</td>
</tr>
<tr id="row74381923174211"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p1490116134310"><a name="p1490116134310"></a><a name="p1490116134310"></a>CTS触发器使用指导</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p154381123114211"><a name="p154381123114211"></a><a name="p154381123114211"></a>云审计服务在记录某些特定关键操作发生时，支持对这些关键操作通过消息通知服务实时向相关订阅者发送通知，该功能由云审计服务触发，消息通知触发用户函数。</p>
</td>
</tr>
<tr id="row3781788710552"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p2350134974818"><a name="p2350134974818"></a><a name="p2350134974818"></a>实时图片分类（按图片大小）</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p274454820210"><a name="p274454820210"></a><a name="p274454820210"></a>上传图片至OBS（对象存储服务）桶，触发函数运行，根据图片大小，分类存储图片到不同的桶中。</p>
</td>
</tr>
<tr id="row10840185420282"><td class="cellrowborder" rowspan="6" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.1 "><p id="p389013942619"><a name="p389013942619"></a><a name="p389013942619"></a>进阶级</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.2 "><p id="p1137915713292"><a name="p1137915713292"></a><a name="p1137915713292"></a>日志实时分析</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p183801570297"><a name="p183801570297"></a><a name="p183801570297"></a>基于LTS云日志服务实时采集日志数据，函数工作流服务中的函数创建LTS触发器获取日志数据，经由自定义函数对日志中的告警信息进行分析和处理，通过SMN服务推送告警信息，并将告警日志集中存储在OBS桶中。</p>
</td>
</tr>
<tr id="row128901199264"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p6220122013299"><a name="p6220122013299"></a><a name="p6220122013299"></a>登录安全实时分析</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p7169427297"><a name="p7169427297"></a><a name="p7169427297"></a>基于CTS云审计服务实时采集用户登录/登出日志，函数工作流服务中的函数创建CTS触发器获取日志数据，通过函数代码过滤白名单，非法登录时SMN服务推送用户订阅的资源信息。</p>
</td>
</tr>
<tr id="row108663474478"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p16782595814"><a name="p16782595814"></a><a name="p16782595814"></a>实时图片分类（按图片内容）</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p158672047134716"><a name="p158672047134716"></a><a name="p158672047134716"></a>基于EI服务构建图片分类的无服务系统。连接EI服务，调用EI服务图片分类接口对图片进行分类，并通过OBS触发器，对每个上传到桶中的图片进行分类处理，自动将图片归档到相应的类别目录下。</p>
</td>
</tr>
<tr id="row9868247114714"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p66538556813"><a name="p66538556813"></a><a name="p66538556813"></a>图片鉴黄</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p1286914473475"><a name="p1286914473475"></a><a name="p1286914473475"></a>基于EI服务构建图片鉴黄的无服务系统。连接EI服务，调用EI服务鉴黄接口检测图片是否为色情图片，并通过APIG触发器提供接口供外部调用。</p>
</td>
</tr>
<tr id="row1686944715472"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p927593519"><a name="p927593519"></a><a name="p927593519"></a>图片鉴黄</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p1387017476471"><a name="p1387017476471"></a><a name="p1387017476471"></a>基于EI服务构建实时图片鉴黄的无服务器系统。连接EI服务，调用EI服务鉴黄接口检测图片是否为色情图片，并通过OBS触发器实现实时图片检测。</p>
</td>
</tr>
<tr id="row11226342105"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p52261644105"><a name="p52261644105"></a><a name="p52261644105"></a>语音识别</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p3226204161010"><a name="p3226204161010"></a><a name="p3226204161010"></a>基于EI服务构建语音识别的无服务系统。连接EI服务，调用EI服务语音识别接口将wav语音文件转化为文字，并通过APIG触发器提供接口供外部调用。</p>
</td>
</tr>
</tbody>
</table>

## 函数模板使用<a name="section666982715557"></a>

**创建函数及触发器**

1.  用户登录FunctionGraph，进入“应用模板”界面。
2.  在“应用模板”界面，选择“SMN触发器使用指导”模板，单击“使用此模板”，如[图1](#fig93204100572)所示。
3.  选择函数模板后，会加载模板内置的代码、配置、触发器信息，进入到创建函数界面。
4.  输入函数名称：read-smn-message。
5.  SMN触发器主题名称选择serverless-Test。

    **图 1**  选择函数模板<a name="fig93204100572"></a>  
    ![](figures/选择函数模板.png "选择函数模板")

6.  单击“创建函数”，创建函数及触发器，如[图2](#fig12320161015576)所示。

    **图 2**  SMN触发器<a name="fig12320161015576"></a>  
    ![](figures/SMN触发器.png "SMN触发器")


**触发函数**

1.  登录“消息通知服务”，单击“主题管理\>主题”，进入“主题”界面。
2.  在“主题”界面，单击serverless-Test消息主题名称，进入“主题详情页”。
3.  在“主题详情页”，单击操作栏的“发布消息”，如[图3](#fig8101161217)所示，弹出“发布消息”界面。

    **图 3**  发布SMN消息<a name="fig8101161217"></a>  
    ![](figures/发布SMN消息.png "发布SMN消息")

4.  在“发布消息”界面，填写发布信息，如[表2](#table1910111112116)所示，带\*参数为必填项。

    **表 2**  发布信息表

    <a name="table1910111112116"></a>
    <table><thead align="left"><tr id="row151011411111"><th class="cellrowborder" valign="top" width="50%" id="mcps1.2.3.1.1"><p id="p1010151917"><a name="p1010151917"></a><a name="p1010151917"></a>字段</p>
    </th>
    <th class="cellrowborder" valign="top" width="50%" id="mcps1.2.3.1.2"><p id="p210112117115"><a name="p210112117115"></a><a name="p210112117115"></a>填写说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row121011716114"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.1 "><p id="p9101316110"><a name="p9101316110"></a><a name="p9101316110"></a>消息标题</p>
    </td>
    <td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.2 "><p id="p141011711516"><a name="p141011711516"></a><a name="p141011711516"></a>输入“SMN-Test”。</p>
    </td>
    </tr>
    <tr id="row3101121719"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.1 "><p id="p181019112118"><a name="p181019112118"></a><a name="p181019112118"></a>*消息类型</p>
    </td>
    <td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.2 "><p id="p17101121019"><a name="p17101121019"></a><a name="p17101121019"></a>选择“文本消息”。</p>
    </td>
    </tr>
    <tr id="row61016119120"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.1 "><p id="p710181817"><a name="p710181817"></a><a name="p710181817"></a>*消息内容</p>
    </td>
    <td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.2 "><p id="p31011511712"><a name="p31011511712"></a><a name="p31011511712"></a>输入以下内容：hello。</p>
    </td>
    </tr>
    </tbody>
    </table>

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >1.  消息发布具体参数说明请参见[向主题发布消息](https://support.huaweicloud.com/usermanual-smn/zh-cn_topic_0043961403.html)。  

5.  单击“确定”，完成消息发布。

    >![](public_sys-resources/icon-note.gif) **说明：**   
    >1.  消息发布以后，会自动触发函数运行，具体示例事件请参见[支持的事件源](http://support.huaweicloud.com/devg-functiongraph/functiongraph_02_0102.html)  。  

6.  消息触发函数运行，返回FunctionGraph查看函数日志。

